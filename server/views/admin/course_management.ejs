<%- include('navbar') %>

<div class="container-fluid px-4 py-4">
  <div class="card shadow-sm">
    <div class="card-header text-white"style="background-color: #6038a4;">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Course Management</h2>
        <button class="btn btn-light btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#courseModal">
          <i class="bi bi-plus-circle"></i> Add Course
        </button>
      </div>
    </div>
    
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col" class="text-nowrap">ID</th>
              <th scope="col">Course</th>
              <th scope="col" class="d-none d-md-table-cell">Description</th>
              <th scope="col" class="text-nowrap">Price</th>
              <th scope="col" class="d-none d-lg-table-cell">Duration</th>
              <th scope="col" class="d-none d-xl-table-cell">Schedule</th>
              <th scope="col" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% if (courses.length > 0) { %>
              <% courses.forEach(course => { %>
                <tr>
                  <td class="fw-semibold"><%= course.id %></td>
                  <td>
                    <div class="d-flex align-items-center">
                      <img src="/server/public/images/<%= course.icon %>" alt="Course icon" class="rounded-circle me-2" width="36" height="36">
                      <div>
                        <div class="fw-semibold"><%= course.title %></div>
                        <small class="text-muted"><%= course.subtitle %></small>
                      </div>
                    </div>
                  </td>
                  <td class="d-none d-md-table-cell text-truncate" style="max-width: 200px;" title="<%= course.description %>">
                    <%= course.description %>
                  </td>
                  <td>
                    <% if (course.price > 0) { %>
                      <span class="badge bg-success">₹<%= course.price %></span>
                    <% } else { %>
                      <span class="badge bg-info">Free</span>
                    <% } %>
                  </td>
                  <td class="d-none d-lg-table-cell"><%= course.duration %></td>
                  <td class="d-none d-xl-table-cell"><%= course.schedule %></td>
                  <td class="text-center">
                    <div class="dropdown">
                      <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots-vertical"></i>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                          <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#viewCourseModal" 
                                  data-course='<%= JSON.stringify(course) %>'>
                            <i class="bi bi-eye me-2"></i>View Details
                          </button>
                        </li>
                        <li>
                          <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#editCourseModal" 
                                  data-course='<%= JSON.stringify(course) %>'>
                            <i class="bi bi-pencil me-2"></i><a href="/admin/editCourse/<%= course.id %>">edit</a>
                          </button>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                          <button class="dropdown-item text-danger" onclick="confirmDelete('')">
                            <i class="bi bi-trash me-2"></i><a href="/admin/deleteCourse/<%= course.id %>">delete</a>
                          </button>
                        </li>
                      </ul>
                    </div>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="7" class="text-center py-4">
                  <div class="d-flex flex-column align-items-center justify-content-center">
                    <i class="bi bi-book text-muted" style="font-size: 2.5rem;"></i>
                    <p class="text-muted mt-2 mb-0">No courses found</p>
                    <button class="btn btn-primary mt-3 btn-sm" data-bs-toggle="modal" data-bs-target="#courseModal">
                      Create New Course
                    </button>
                  </div>
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    
    <% if (courses.length > 0) { %>
      <div class="card-footer bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <div class="text-muted small">
            Showing <span class="fw-semibold"><%= courses.length %></span> courses
          </div>
          <nav>
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1">Previous</a>
              </li>
              <li class="page-item active"><a class="page-link" href="#">1</a></li>
              <li class="page-item"><a class="page-link" href="#">2</a></li>
              <li class="page-item"><a class="page-link" href="#">3</a></li>
              <li class="page-item">
                <a class="page-link" href="#">Next</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    <% } %>
  </div>
</div>

<!-- Add/Edit Course Modal -->
<div class="modal fade" id="courseModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Course</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="courseForm" action="/admin/save_courses" method="post" enctype="multipart/form-data">
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Course Title*</label>
              <input type="text" name="title" class="form-control" placeholder="Enter course title" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Subtitle</label>
              <input type="text" name="subtitle" class="form-control" placeholder="Enter subtitle">
            </div>
            <div class="col-12 mb-3">
              <label class="form-label">Description*</label>
              <textarea name="description" class="form-control" rows="3" placeholder="Course description" required></textarea>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Duration*</label>
              <input type="text" name="duration" class="form-control" placeholder="e.g., 6 months" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Eligibility</label>
              <input type="text" name="eligibility" class="form-control" placeholder="e.g., Grade 10-12">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Batch Size</label>
              <input type="number" name="batch_size" class="form-control" placeholder="e.g., 30">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Schedule*</label>
              <input type="text" name="schedule" class="form-control" placeholder="e.g., Weekends Only" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Price (₹)*</label>
              <input type="number" name="price" class="form-control" placeholder="e.g., 9999" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Topics* <small>(comma-separated)</small></label>
              <input type="text" name="topics" class="form-control" placeholder="e.g., HTML, CSS, JavaScript" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Course Icon (Image)</label>
              <input type="file" name="icon" class="form-control" accept="image/*">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Course</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- View Course Modal -->
<div class="modal fade" id="viewCourseModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Course Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="courseDetailsContent">
        <!-- Content will be loaded dynamically via JavaScript -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  // View Course Details
  document.getElementById('viewCourseModal').addEventListener('show.bs.modal', function(event) {
    const button = event.relatedTarget;
    const course = JSON.parse(button.getAttribute('data-course'));
    
    const topicsList = course.topics.split(',').map(topic => 
      `<li class="mb-1">${topic.trim()}</li>`
    ).join('');
    
    const content = `
      <div class="row">
        <div class="col-md-4 text-center mb-3">
          <img src="${course.icon}" alt="Course icon" class="img-fluid rounded" style="max-height: 200px;">
        </div>
        <div class="col-md-8">
          <h4>${course.title}</h4>
          <p class="text-muted">${course.subtitle}</p>
          <hr>
          <p>${course.description}</p>
          
          <div class="row mt-3">
            <div class="col-md-6">
              <p><strong>Duration:</strong> ${course.duration}</p>
              <p><strong>Eligibility:</strong> ${course.eligibility || 'N/A'}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Batch Size:</strong> ${course.batch_size || 'N/A'}</p>
              <p><strong>Schedule:</strong> ${course.schedule}</p>
            </div>
          </div>
          
          <div class="mt-3">
            <h6>Topics Covered:</h6>
            <ul class="list-unstyled row">
              ${topicsList}
            </ul>
          </div>
          
          <div class="d-flex justify-content-between align-items-center mt-3">
            <span class="badge bg-${course.price > 0 ? 'success' : 'info'} fs-6">
              ${course.price > 0 ? '₹' + course.price : 'Free'}
            </span>
          </div>
        </div>
      </div>
    `;
    
    document.getElementById('courseDetailsContent').innerHTML = content;
  });

  // Confirm before deleting
  function confirmDelete(courseId) {
    if (confirm('Are you sure you want to delete this course?')) {
      // Perform delete action
      window.location.href = `/delete_course?id=${courseId}`;
    }
  }
</script>

<%- include('footer') %>